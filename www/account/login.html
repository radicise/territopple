<!DOCTYPE html>
<html>
    <head>
        <script src="/_icons.js"></script>
        <title>Territopple - Login</title>
    </head>
    <body>
        <p id="msg"></p>
        <div id="form-container">
            <label for="cf-id">Account ID:</label><input type="text" id="cf-id"><br>
            <label for="cf-pw">Password:</label><input type="password" id="cf-pw"><br>
            <input type="button" value="Submit" id="cf-submit">
        </div>
        <p>Don't have an account? <a href="/account/create" target="_self">create one</a> or <a href="/" target="_self">return home</a>.</p>
        <script>
            fetch("https://territopple.net/acc/pub/logged-in", {method:"GET"}).then(v => {
                if (v.status === 200) {
                    location.href = "/";
                }
            });
            const id = document.getElementById("cf-id");
            const pw = document.getElementById("cf-pw");
            const msg = document.getElementById("msg");
            document.getElementById("cf-submit").addEventListener("click", () => {
                if ([id,pw].some(v => !v.value)) {
                    return;
                }
                fetch("https://territopple.net/acc/login", {method:"POST",headers:[["Content-Type","application/json"]],body:JSON.stringify({"id":id.value,"pw":pw.value})}).then(v => {
                    if (v.status === 200) {
                        msg.textContent = "logged in, redirecting soon";
                    } else if (v.status === 403) {
                        msg.textContent = "incorrect credentials";
                    } else if (v.status === 500) {
                        msg.textContent = "server error";
                    } else if (v.status === 422) {
                        msg.textContent = "bad JSON";
                    } else if (v.status === 400) {
                        msg.textContent = "sec fail";
                    } else if (v.status === 404) {
                        msg.textContent = "account not found";
                    }
                });
            });
        </script>
    </body>
</html>
