<!DOCTYPE html>
<html>
    <head>
        <script src="/_icons.js"></script>
        <title>Password Reset - Territopple</title>
    </head>
    <body>
        <label for="account-id">Account Id: </label>
        <input type="text" id="account-id"><br>
        <label for="account-email">Email: </label>
        <input type="email" id="account-email"><br>
        <input type="button" value="submit"><br>
        <p id="message-area"></p>
        <script>
            /**@type {HTMLInputElement} */
            const id = document.getElementById("account-id");
            /**@type {HTMLInputElement} */
            const email = document.getElementById("account-email");
            /**@type {HTMLParagraphElement} */
            const msgarea = document.getElementById("message-area");
            /**@type {HTMLInputElement} */
            const submit = document.getElementById("submit");
            submit.onclick = () => {
                if (!id.value || !email.value) {
                    msgarea.textContent = "Error: must enter both account id and account email";
                    return;
                }
                const prom = fetch(`https://territopple.net/acc/reset-password`, {method:"POST",body:JSON.stringify({id:id.value,email:email.value})});
                msgarea.textContent = "Sending reset request";
                prom.then(async v => {
                    switch (v.status) {
                        case 200: {
                            msgarea.textContent = "Request sent, check your inbox for a password reset email";
                            return;
                        }
                        case 400: {
                            msgarea.textContent = "Error with request, please send an email to reports@territopple.net with the values entered into the account id and email fields";
                            return;
                        }
                        case 403: {
                            msgarea.textContent = "Error: we couldn't find an account with that id and email";
                            return;
                        }
                        case 500: {
                            msgarea.textContent = `Error: ${await (await v.blob()).text()}`;
                            return;
                        }
                        default: {
                            msgarea.textContent = "Error: the server is not currently available, please try again later";
                            return;
                        }
                    }
                });
            };
        </script>
    </body>
</html>
