<!DOCTYPE html>
<html>
    <head>
        <script src="/_icons.js"></script>
        <title>Territopple - Account Settings</title>
    </head>
    <body>
        <a href="/" target="_self">home</a>
        <a href="/account/info" target="_self">back</a>
        <div id="basic-info-cont">
            ID: <span id="acc-id">...</span> (cannot be changed)<br>
            Name: <input type="text" disabled value="..." id="acc-name"><br>
            Joined: <input type="text" disabled value="..." id="acc-cdate"><br>
            Last Online: <input type="text" disabled value="..." id="acc-lo"><br>
            Level: <input type="text" disabled value="..." id="acc-lvl"><br>
            Email: <span id="acc-email">...</span> (to change the account email, please contact the server operator)
        </div>
        <script>
            /**
             * @param {string} eid
             * @param {HTMLInputElement} btn
             */
            function BI_edit(eid, btn) {
                btn.title = "Done";
                btn.alt = "Done Button";
                btn.src = "/account/icons/setdone.svg";
                document.getElementById(eid).disabled = false;
                btn.onclick = ()=>{BI_done(eid, btn);};
            }
            /**
             * @param {string} eid
             * @param {HTMLInputElement} btn
             */
            function BI_done(eid, btn) {
                btn.title = "Edit";
                btn.alt = "Edit Button";
                btn.src = "/account/icons/setedit.svg";
                document.getElementById(eid).disabled = true;
                btn.onclick = ()=>{BI_edit(eid, btn);};
            }
            document.getElementById("basic-info-cont").querySelectorAll("input").forEach(e => {const b = document.createElement("input");b.type="image";b.src="/account/icons/setedit.svg";b.alt="Edit Button";b.title="Edit";b.onclick=()=>{BI_edit(e.id,b);};e.after(b);});
            fetch(`https://${document.location.hostname}/acc/pub/$40self/info`, {method:"GET"}).then(v => {
                // console.log(v);
                if (v.status === 403) {
                    document.getElementById("acc-id").textContent = "unauthorized";
                    return;
                }
                // v = JSON.parse(v.text);
                v.json().then(j => {
                    if (sendID === "%40self" || sendID === j.rid) {
                        const b = document.createElement("input");
                        b.type = "button";
                        b.value = "logout";
                        b.onclick = () => {
                            fetch(`https://${document.location.hostname}/acc/pub/logout`, {method:"GET"}).then(() => {location.href="/account/login";});
                        }
                        document.getElementById("acc").append(document.createElement("br"), b);
                    }
                    document.getElementById("acc-id").textContent = j.id;
                    document.getElementById("acc-name").textContent = j.name;
                    document.getElementById("acc-cdate").textContent = new Date(j.cdate).toString();
                    document.getElementById("acc-lo").textContent = new Date(j.last_online).toString();
                    document.getElementById("acc-lvl").textContent = j.level;
                    document.getElementById("acc-email").textContent = j.email ?? "unavailable";
                    if (j.sanction !== null) {
                        document.getElementById("acc").append(`Sanction: ${j.sanction}`);
                    }
                });
            });
        </script>
        <script src="/components/include.js"></script>
    </body>
</html>
